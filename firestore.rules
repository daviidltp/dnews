rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Colección de artículos creados por el usuario
    match /articles/{articleId} {
      allow read: if true;  // Lectura libre
      allow write: if validateArticle(request.resource.data, true);  // Escritura con validación
    }

    // Colección de artículos de la API guardados (bookmarks)
    match /bookmarks/{bookmarkId} {
      allow read: if true;  // Lectura libre
      allow write: if validateArticle(request.resource.data, false);  // Escritura con validación
    }

    function validateArticle(data, isUserArticle) {
      return (
        data.keys().hasAll([
          'id', 'author', 'source', 'category', 'title',
          'description', 'content', 'url', 'urlToImage',
          'lectureTime', 'publishedAt', 'saved'
        ]) &&
        data.id is int &&
        data.author is string &&
        data.source is string &&
        data.category is string &&
        data.title is string &&
        data.description is string &&
        data.content is string &&
        ((isUserArticle && data.url == null) || (!isUserArticle && data.url is string)) &&
        data.urlToImage is string &&
        data.lectureTime is int &&
        data.publishedAt is string &&
        data.saved is bool
      );
    }
  }
}
